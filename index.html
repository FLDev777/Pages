<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick-shift logger</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .container { max-width: 600px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-primary { width: 100%; padding: 12px; font-size: 1.2rem; }
        /* Center the success message content */
        .modal-body h3 { margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="mb-4 text-center">Shift Logger</h2>
    
    <form id="shiftForm">
        <!-- Date Picker -->
        <div class="mb-3">
            <label for="shiftDate" class="form-label">Date</label>
            <input type="date" class="form-control" id="shiftDate" required>
        </div>

        <!-- Start Time (24h input) -->
        <div class="mb-3">
            <label for="startTime" class="form-label">Start Time</label>
            <input type="time" class="form-control" id="startTime" required>
        </div>

        <!-- End Time (24h input) -->
        <div class="mb-3">
            <label for="endTime" class="form-label">End Time</label>
            <input type="time" class="form-control" id="endTime" required>
        </div>

        <button type="submit" id="submitBtn" class="btn btn-primary">SEND</button>
    </form>
</div>

<!-- Success Modal (The "Popup") -->
<div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center">
        <!-- Green Checkmark Icon -->
        <div class="mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="#198754" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
              <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
            </svg>
        </div>
        <h3 class="text-success">Done!</h3>
        <button type="button" class="btn btn-secondary mt-3 w-100" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS Bundle (Required for Modals) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // --- CONFIGURATION ---
    const GOOGLE_FORM_URL = 'https://docs.google.com/forms/u/0/d/e/1FAIpQLSccgL6jC-6QCyMs2V14Zout6R2IL60v7qedCU1P-_vFL45HxQ/formResponse';
    
    // Field IDs
    const FIELD_DATE_YEAR = 'entry.1602883467_year';
    const FIELD_DATE_MONTH = 'entry.1602883467_month';
    const FIELD_DATE_DAY  = 'entry.1602883467_day';
    
    const FIELD_START_HOUR   = 'entry.1985115734_hour';
    const FIELD_START_MINUTE = 'entry.1985115734_minute';
    const FIELD_START_AMPM   = 'entry.1985115734_ampm';
    
    const FIELD_END_HOUR   = 'entry.337026052_hour';
    const FIELD_END_MINUTE = 'entry.337026052_minute';
    const FIELD_END_AMPM   = 'entry.337026052_ampm';

    // --- LOGIC ---
    document.getElementById('shiftForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const btn = document.getElementById('submitBtn');
        const originalText = btn.innerText;
        btn.disabled = true;
        btn.innerText = "Sending...";

        try {
            // 1. Get Values
            const dateVal = document.getElementById('shiftDate').value; 
            const startVal = document.getElementById('startTime').value; 
            const endVal = document.getElementById('endTime').value;     

            if(!dateVal || !startVal || !endVal) throw new Error("All fields required");

            // 2. Parse Date
            const [year, month, day] = dateVal.split('-');

            // 3. Helper: Convert 24h to 12h
            function convertTo12Hour(timeStr) {
                let [h, m] = timeStr.split(':');
                h = parseInt(h);
                let ampm = h >= 12 ? 'PM' : 'AM';
                h = h % 12;
                h = h ? h : 12; 
                return { h: h, m: m, ampm: ampm };
            }

            const start = convertTo12Hour(startVal);
            const end = convertTo12Hour(endVal);

            // 4. Build Payload
            const data = new URLSearchParams();
            data.append(FIELD_DATE_YEAR, year);
            data.append(FIELD_DATE_MONTH, month);
            data.append(FIELD_DATE_DAY, day);
            
            data.append(FIELD_START_HOUR, start.h);
            data.append(FIELD_START_MINUTE, start.m);
            data.append(FIELD_START_AMPM, start.ampm);
            
            data.append(FIELD_END_HOUR, end.h);
            data.append(FIELD_END_MINUTE, end.m);
            data.append(FIELD_END_AMPM, end.ampm);
            
            data.append('pageHistory', '0');

            // 5. Send
            fetch(GOOGLE_FORM_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: data
            })
            .then(() => {
                // Success!
                document.getElementById('shiftForm').reset();
                document.getElementById('shiftDate').valueAsDate = new Date(); // Reset date to today
                
                // Show the Bootstrap Modal "Done!" popup
                const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                successModal.show();
            })
            .catch(err => {
                alert('Error: ' + err.message);
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerText = originalText;
            });

        } catch (error) {
            alert("Setup Error: " + error);
            btn.disabled = false;
            btn.innerText = originalText;
        }
    });

    // Initialize date picker to today
    document.getElementById('shiftDate').valueAsDate = new Date();
</script>

</body>
</html>
